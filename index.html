<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Identicon Generator</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // SVG Icons as components
    const Download = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="7 10 12 15 17 10"></polyline>
        <line x1="12" y1="15" x2="12" y2="3"></line>
      </svg>
    );

    const Shuffle = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="16 3 21 3 21 8"></polyline>
        <line x1="4" y1="20" x2="21" y2="3"></line>
        <polyline points="21 16 21 21 16 21"></polyline>
        <line x1="15" y1="15" x2="21" y2="21"></line>
        <line x1="4" y1="4" x2="9" y2="9"></line>
      </svg>
    );

    const User = () => (
      <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
        <circle cx="12" cy="7" r="4"></circle>
      </svg>
    );

    const IdenticonGenerator = () => {
      const [username, setUsername] = useState('');
      const [gridSize, setGridSize] = useState(5);
      const canvasRef = useRef(null);

      const generateHash = (input) => {
        let hash = 0;
        for (let i = 0; i < input.length; i++) {
          const char = input.charCodeAt(i);
          hash = ((hash << 5) - hash) + char;
          hash = hash & hash;
        }
        return Math.abs(hash);
      };

      const generateGrid = (input, size) => {
        if (!input) return null;
        
        const hash = generateHash(input);
        const grid = Array(size).fill().map(() => Array(size).fill(false));
        const half = Math.ceil(size / 2);
        
        let bitIndex = 0;
        for (let y = 0; y < size; y++) {
          for (let x = 0; x < half; x++) {
            const byte = (hash >> (bitIndex % 32)) & 0xFF;
            const bit = (byte >> (bitIndex % 8)) & 1;
            const value = bit === 1;
            
            grid[y][x] = value;
            grid[y][size - 1 - x] = value;
            bitIndex++;
          }
        }
        
        return grid;
      };

      const hsvToRgb = (h, s, v) => {
        h = h % 360;
        const c = v * s;
        const x = c * (1 - Math.abs(((h / 60) % 2) - 1));
        const m = v - c;
        
        let r1, g1, b1;
        if (h < 60) [r1, g1, b1] = [c, x, 0];
        else if (h < 120) [r1, g1, b1] = [x, c, 0];
        else if (h < 180) [r1, g1, b1] = [0, c, x];
        else if (h < 240) [r1, g1, b1] = [0, x, c];
        else if (h < 300) [r1, g1, b1] = [x, 0, c];
        else [r1, g1, b1] = [c, 0, x];
        
        const r = Math.round((r1 + m) * 255);
        const g = Math.round((g1 + m) * 255);
        const b = Math.round((b1 + m) * 255);
        
        return `rgb(${r}, ${g}, ${b})`;
      };

      const drawIdenticon = () => {
        const canvas = canvasRef.current;
        if (!canvas || !username) return;
        
        const ctx = canvas.getContext('2d');
        const size = 400;
        canvas.width = size;
        canvas.height = size;
        
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, size, size);
        
        const grid = generateGrid(username, gridSize);
        if (!grid) return;
        
        const hash = generateHash(username);
        const hue = (hash % 360);
        const color = hsvToRgb(hue, 0.65, 0.5);
        
        const cellSize = size / gridSize;
        
        ctx.fillStyle = color;
        for (let y = 0; y < gridSize; y++) {
          for (let x = 0; x < gridSize; x++) {
            if (grid[y][x]) {
              const x0 = Math.floor(x * cellSize);
              const y0 = Math.floor(y * cellSize);
              const width = Math.ceil(cellSize);
              const height = Math.ceil(cellSize);
              ctx.fillRect(x0, y0, width, height);
            }
          }
        }
      };

      useEffect(() => {
        drawIdenticon();
      }, [username, gridSize]);

      const handleDownload = () => {
        const canvas = canvasRef.current;
        if (!canvas) return;
        
        const link = document.createElement('a');
        link.download = `${username || 'identicon'}-avatar.png`;
        link.href = canvas.toDataURL();
        link.click();
      };

      const handleRandomUsername = () => {
        const random = Math.random().toString(36).substring(2, 12);
        setUsername(random);
      };

      return (
        <div className="min-h-screen bg-stone-100 p-8">
          <div className="max-w-4xl mx-auto">
            <div className="mb-8">
              <div className="flex items-center gap-3 mb-3">
                <div className="text-green-700">
                  <User />
                </div>
                <h1 className="text-4xl font-bold text-gray-800">
                  Identicon Generator
                </h1>
              </div>
              <p className="text-gray-600 text-base font-mono">
                → Create unique avatar patterns from any username
              </p>
            </div>

            <div className="bg-white rounded-lg shadow-md border-2 border-gray-300 p-8">
              <div className="grid md:grid-cols-2 gap-8">
                <div className="space-y-6">
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2 font-mono">
                      username:
                    </label>
                    <div className="flex gap-2">
                      <input
                        type="text"
                        value={username}
                        onChange={(e) => setUsername(e.target.value)}
                        placeholder="Enter username..."
                        className="flex-1 px-4 py-3 border-2 border-gray-300 rounded focus:border-green-600 focus:outline-none transition-colors font-mono"
                      />
                      <button
                        onClick={handleRandomUsername}
                        className="px-4 py-3 bg-stone-200 hover:bg-stone-300 border-2 border-gray-300 rounded transition-colors"
                        title="Random username"
                      >
                        <Shuffle />
                      </button>
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2 font-mono">
                      grid size: {gridSize}x{gridSize}
                    </label>
                    <input
                      type="range"
                      min="3"
                      max="9"
                      step="2"
                      value={gridSize}
                      onChange={(e) => setGridSize(parseInt(e.target.value))}
                      className="w-full h-2 bg-gray-300 rounded appearance-none cursor-pointer accent-green-700"
                    />
                    <div className="flex justify-between text-xs text-gray-500 mt-1 font-mono">
                      <span>3x3</span>
                      <span>5x5</span>
                      <span>7x7</span>
                      <span>9x9</span>
                    </div>
                  </div>

                  <button
                    onClick={handleDownload}
                    disabled={!username}
                    className="w-full px-6 py-4 bg-green-700 text-white rounded font-semibold hover:bg-green-800 disabled:bg-gray-400 disabled:cursor-not-allowed transition-all border-2 border-green-800 disabled:border-gray-500 flex items-center justify-center gap-2 font-mono"
                  >
                    <Download />
                    <span>download avatar.png</span>
                  </button>

                  <div className="bg-stone-50 rounded border-2 border-gray-300 p-4">
                    <h3 className="font-semibold text-gray-800 mb-2 font-mono">// how it works</h3>
                    <ul className="text-sm text-gray-600 space-y-1 font-mono">
                      <li>• Each username generates a unique pattern</li>
                      <li>• Pattern is symmetrical for visual appeal</li>
                      <li>• Color is derived from the username hash</li>
                      <li>• Perfect for user avatars and profiles</li>
                    </ul>
                  </div>
                </div>

                <div className="flex flex-col items-center justify-center">
                  <div className="bg-white rounded shadow-md p-4 border-2 border-gray-300">
                    <canvas
                      ref={canvasRef}
                      className="max-w-full h-auto"
                      style={{imageRendering: 'pixelated'}}
                    />
                  </div>
                  {!username && (
                    <p className="text-gray-500 text-sm mt-4 text-center font-mono">
                      → Enter a username to generate your identicon
                    </p>
                  )}
                </div>
              </div>
            </div>

            <div className="mt-8 text-gray-600 text-sm font-mono">
              <p>// vibecoded with ai by <a href="https://github.com/ssnofall" target="_blank" rel="noopener noreferrer" className="text-green-600 hover:underline">snofall</a></p>
              <p>// generates deterministic avatar patterns</p>
            </div>
          </div>
        </div>
      );
    };

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<IdenticonGenerator />);
  </script>
</body>
</html>
